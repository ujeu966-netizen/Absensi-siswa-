<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Jurnal Apex V25 - Final Edition</title>
    
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/js/all.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@300;400;600;800&display=swap" rel="stylesheet">

    <style>
        :root { --pri: #0f172a; --sec: #10b981; --gold: #fbbf24; --bg: #f8fafc; }
        * { box-sizing: border-box; -webkit-tap-highlight-color: transparent; font-family: 'Plus Jakarta Sans', sans-serif; }
        body { background: var(--bg); color: #1e293b; margin: 0; overflow: hidden; height: 100vh; }
        
        .watermark { position: fixed; bottom: 85px; right: 20px; font-weight: 800; font-size: 11px; opacity: 0.15; z-index: 999; pointer-events: none; }

        /* Header Premium */
        .header { background: var(--pri); color: white; padding: 15px 20px; height: 140px; display: flex; justify-content: space-between; align-items: center; border-bottom: 4px solid var(--sec); }
        .identitas-box { display: flex; align-items: center; gap: 12px; }
        .school-logo { width: 45px; height: 45px; border-radius: 12px; border: 1.5px solid rgba(255,255,255,0.2); object-fit: cover; background: white; }
        .guru-pic { width: 50px; height: 50px; border-radius: 50%; border: 2px solid var(--gold); object-fit: cover; background: #334155; }
        
        .sync-status { display: flex; align-items: center; gap: 5px; font-size: 10px; font-weight: 800; margin-top: 5px; }
        .status-dot { width: 8px; height: 8px; border-radius: 50%; }
        .status-online { background: #10b981; box-shadow: 0 0 10px #10b981; } 
        .status-offline { background: #fbbf24; box-shadow: 0 0 10px #fbbf24; }

        .toolbar { display: flex; overflow-x: auto; gap: 8px; padding: 12px 20px; background: white; border-bottom: 1px solid #e2e8f0; scrollbar-width: none; }
        .t-btn { white-space: nowrap; padding: 8px 16px; border-radius: 12px; background: #f1f5f9; border: 1px solid #e2e8f0; font-size: 11px; font-weight: 700; color: #64748b; cursor: pointer; }
        .t-btn.active-sch { background: var(--pri); color: white; border-color: var(--pri); }

        .content-area { height: calc(100vh - 140px - 58px - 75px); overflow-y: auto; padding: 15px; display: none; }
        .content-active { display: block; }
        .card { background: white; border-radius: 20px; padding: 20px; margin-bottom: 15px; border: 1px solid #edf2f7; }

        /* Matrix Style */
        .scroll-table { overflow-x: auto; border-radius: 15px; border: 1px solid #e2e8f0; background: white; }
        table { border-collapse: collapse; min-width: 100%; }
        th { background: #f8fafc; padding: 12px 8px; font-size: 10px; font-weight: 800; border: 1px solid #f1f5f9; color: #94a3b8; }
        th:nth-child(2) { width: 150px; text-align: left; position: sticky; left: 0; background: #f8fafc; z-index: 5; }
        td { padding: 8px; border: 1px solid #f1f5f9; text-align: center; font-size: 12px; font-weight: 700; height: 45px; }
        td:nth-child(2) { text-align: left; position: sticky; left: 0; background: white; z-index: 5; border-right: 2px solid #f1f5f9; }

        .day-box { width: 34px; height: 34px; margin: 0 auto; cursor: pointer; border-radius: 10px; display: flex; align-items: center; justify-content: center; border: 1px solid #f1f5f9; transition: 0.2s; }
        .h-style { background: #10b981 !important; color: white !important; }
        .i-style { background: #fbbf24 !important; color: white !important; }
        .s-style { background: #3b82f6 !important; color: white !important; }
        .a-style { background: #ef4444 !important; color: white !important; }

        .inp { width: 100%; padding: 14px; border-radius: 14px; border: 1.5px solid #e2e8f0; margin-bottom: 12px; font-size: 14px; background: #f8fafc; outline: none; }
        .btn-p { background: var(--pri); color: white; border: none; padding: 16px; border-radius: 14px; width: 100%; font-weight: 800; cursor: pointer; display: flex; align-items: center; justify-content: center; gap: 10px; }
        
        .nav { position: fixed; bottom: 0; width: 100%; height: 75px; background: white; display: flex; border-top: 1px solid #f1f5f9; z-index: 500; }
        .nav-item { flex: 1; display: flex; flex-direction: column; align-items: center; justify-content: center; font-size: 10px; font-weight: 800; color: #94a3b8; gap: 4px; }
        .nav-item.active { color: var(--pri); }
        
        #zoomOverlay { position: fixed; inset: 0; background: rgba(15, 23, 42, 0.95); z-index: 2000; display: none; align-items: center; justify-content: center; }
        .shield { opacity: 0.3; pointer-events: none; filter: grayscale(1); }
        .preview-box { width: 80px; height: 80px; border-radius: 12px; object-fit: cover; display: none; margin: 0 auto 10px; border: 3px solid var(--sec); }
    </style>
</head>
<body>

<div class="watermark">by Usu</div>
<div id="zoomOverlay" onclick="this.style.display='none'"><img id="zoomImg" style="max-width:85%; border-radius:20px; border:4px solid white;"></div>

<div id="loginOverlay" style="position:fixed; inset:0; background:var(--pri); z-index:3000; display:flex; flex-direction:column; align-items:center; justify-content:center; color:white;">
    <div style="text-align:center; padding:40px; border-radius:30px; width: 85%; background: rgba(255,255,255,0.02); backdrop-filter: blur(20px); border: 1px solid rgba(255,255,255,0.1);">
        <i class="fas fa-atom fa-spin" style="font-size:60px; color:var(--sec); margin-bottom:20px;"></i>
        <h2 style="margin:0;">APEX QUANTUM</h2>
        <p style="font-size:10px; opacity:0.6; margin-bottom:30px;">Professional Journal System</p>
        <input type="text" id="accId" class="inp" style="text-align:center;" placeholder="MASUKKAN ID AKUN">
        <input type="password" id="passInp" class="inp" style="text-align:center; letter-spacing:10px;" placeholder="****">
        <button class="btn-p" style="background:var(--sec);" onclick="checkLogin()">MASUK SISTEM</button>
    </div>
</div>

<div class="header">
    <div class="identitas-box">
        <div style="display:flex; flex-direction:column; gap:8px;">
            <img id="hLogo" src="" class="school-logo">
            <img id="hGuruPic" src="" class="guru-pic">
        </div>
        <div>
            <div id="hSchName" style="font-weight:800; font-size:15px;">...</div>
            <div id="hGuruName" style="font-size:12px; color:var(--gold); font-weight:600;">...</div>
            <div class="sync-status">
                <div id="statusDot" class="status-dot status-offline"></div>
                <span id="statusText">D-ONLINE</span>
            </div>
        </div>
    </div>
    <div style="text-align:right">
        <div id="liveClock" style="font-family:monospace; font-size:15px; font-weight:800;">00:00:00</div>
        <div id="hClassName" style="font-size:9px; font-weight:800; background:rgba(16, 185, 129, 0.2); color:var(--sec); padding:4px 10px; border-radius:20px; margin-top:8px;">...</div>
    </div>
</div>

<div class="toolbar" id="schBar"></div>

<div id="m0" class="content-area content-active">
    <div class="card" id="mainMatrix">
        <div style="display:flex; gap:10px; margin-bottom:15px;">
            <select id="selMonth" class="inp" style="margin:0; flex:1.5; font-weight:800;" onchange="renderMatrix()"></select>
            <select id="selClass" class="inp" style="margin:0; flex:1; font-weight:800;" onchange="switchClass(this.value)"></select>
        </div>
        <div id="matrixTableArea" class="scroll-table"><table><thead id="mHead"></thead><tbody id="mBody"></tbody></table></div>
    </div>
</div>

<div id="m1" class="content-area">
    <div class="card"><h3><i class="fas fa-users"></i> Database Siswa</h3><div id="studentList"></div></div>
</div>

<div id="m2" class="content-area">
    <div class="card">
        <h3><i class="fas fa-file-invoice"></i> Rekap Jurnal</h3>
        <select id="rekapType" class="inp" onchange="renderRekap()"><option value="S1">Semester 1</option><option value="S2">Semester 2</option><option value="THN">Tahunan</option></select>
        <div id="rekapResult" class="scroll-table"></div>
    </div>
</div>

<div id="m3" class="content-area">
    <div class="card"><h3><i class="fas fa-images"></i> Galeri Foto</h3><div id="photoGrid" style="display:grid; grid-template-columns: repeat(3, 1fr); gap:10px;"></div></div>
</div>

<div id="m4" class="content-area">
    <div class="card" style="background:var(--pri); color:white;">
        <h3 style="color:white"><i class="fas fa-gears"></i> Konfigurasi</h3>
        <button class="btn-p" style="background:var(--gold); color:var(--pri);" onclick="toggleLock()"><i class="fas fa-lock"></i> BUKA PANEL EDIT (234)</button>
    </div>

    <div id="adminPanel" class="shield">
        <div class="card">
            <h4><i class="fas fa-pen-fancy"></i> Edit Branding</h4>
            <input type="text" id="inSchName" class="inp" placeholder="Nama Sekolah">
            <input type="text" id="inGuruName" class="inp" placeholder="Nama Guru">
            <div style="display:grid; grid-template-columns: 1fr 1fr; gap:15px; margin-bottom:15px;">
                <div style="text-align:center" onclick="document.getElementById('inLogo').click()"><input type="file" id="inLogo" hidden onchange="preView(this, 'pL')"><img id="pL" class="preview-box"><div>Logo</div></div>
                <div style="text-align:center" onclick="document.getElementById('inGuruF').click()"><input type="file" id="inGuruF" hidden onchange="preView(this, 'pG')"><img id="pG" class="preview-box" style="border-radius:50%"><div>Foto Guru</div></div>
            </div>
            <button class="btn-p" style="background:var(--sec)" onclick="confirmSaveBranding()">SIMPAN BRANDING</button>
        </div>

        <div class="card">
            <h4><i class="fas fa-folder-plus"></i> Management Kelas & Unit</h4>
            <input type="text" id="newClassInp" class="inp" placeholder="Nama Kelas Baru (Contoh: Kelas 7A)">
            <button class="btn-p" onclick="confirmAddClass()" style="margin-bottom:15px;">TAMBAH KELAS</button>
            <input type="text" id="newSchInp" class="inp" placeholder="Nama Unit Baru (Contoh: SMP Merdeka)">
            <button class="btn-p" onclick="confirmAddSchool()">TAMBAH UNIT</button>
        </div>

        <div class="card">
            <h4><i class="fas fa-user-plus"></i> Edit Siswa</h4>
            <div style="text-align:center" onclick="document.getElementById('inSiswaFoto').click()"><input type="file" id="inSiswaFoto" hidden onchange="preView(this, 'pS')"><img id="pS" class="preview-box" style="display:block; width:100px; height:100px; border:2px dashed #ccc;"><p style="font-size:10px;">Klik Upload Foto</p></div>
            <input type="hidden" id="editSId"><input type="text" id="inSiswaName" class="inp" placeholder="Nama Siswa">
            <button class="btn-p" style="background:var(--sec)" onclick="confirmSiswa()">SIMPAN SISWA</button>
        </div>

        <div class="card">
            <h4><i class="fas fa-sync"></i> Data & Export</h4>
            <div style="display:grid; grid-template-columns: 1fr 1fr; gap:10px;">
                <button class="btn-p" onclick="exportExcel()">EXCEL</button>
                <button class="btn-p" onclick="Swal.fire('Cloud Backup','Data Berhasil Disinkron','success')">DRIVE</button>
                <button class="btn-p" onclick="location.reload()" style="background:#64748b; grid-column:span 2;">REFRESH</button>
                <button class="btn-p" onclick="resetSystem()" style="background:#ef4444; grid-column:span 2;">HAPUS SEMUA</button>
            </div>
        </div>
    </div>
</div>

<nav class="nav">
    <div class="nav-item active" onclick="nav(0)"><i class="fas fa-calendar-alt"></i>Absen</div>
    <div class="nav-item" onclick="nav(1)"><i class="fas fa-user-group"></i>Siswa</div>
    <div class="nav-item" onclick="nav(2)"><i class="fas fa-file-lines"></i>Rekap</div>
    <div class="nav-item" onclick="nav(3)"><i class="fas fa-images"></i>Foto</div>
    <div class="nav-item" onclick="nav(4)"><i class="fas fa-sliders-h"></i>Setting</div>
</nav>

<script>
    const DB_NAME = "UsuApexFinal_V25";
    let db, currentAcc = "def";
    // KELAS DIKOSONGKAN SESUAI PERMINTAAN
    let master = {
        activeSch: "def", locked: true,
        schools: { "def": { name: "UNIT SEKOLAH", guru: "Nama Guru", logo: "", guruPic: "", activeCls: "", classes: {} }}
    };

    const apexToast = (msg, icon='success') => {
        Swal.mixin({ toast: true, position: 'top-end', showConfirmButton: false, timer: 2000 }).fire({ icon, title: msg });
    };

    function checkLogin() {
        const pin = document.getElementById('passInp').value;
        const id = document.getElementById('accId').value;
        if(pin === "234" && id !== "") {
            currentAcc = id; sessionStorage.setItem('usu_auth_v25', 'true'); sessionStorage.setItem('usu_acc_id', id);
            document.getElementById('loginOverlay').style.display = 'none'; initDB();
        } else { Swal.fire('Error','PIN 234 Salah','error'); }
    }

    function initDB() {
        const req = indexedDB.open(DB_NAME, 1);
        req.onupgradeneeded = e => { e.target.result.createObjectStore("store", { keyPath: "id" }); };
        req.onsuccess = e => { db = e.target.result; loadData(); };
    }

    function loadData() {
        const tx = db.transaction("store", "readonly").objectStore("store").get(currentAcc);
        tx.onsuccess = () => { if(tx.result) master = tx.result.val; startApp(); };
    }

    function save() { 
        db.transaction("store", "readwrite").objectStore("store").put({ id: currentAcc, val: master }); 
        updateUI(); 
        document.getElementById('statusDot').className = "status-dot status-offline";
        if(navigator.onLine) {
            setTimeout(() => {
                document.getElementById('statusDot').className = "status-dot status-online";
                localStorage.setItem('apex_sync_'+currentAcc, JSON.stringify(master));
            }, 1000);
        }
    }

    // CONFIRMATIONS
    function confirmSiswa() {
        const n = document.getElementById('inSiswaName').value; if(!n) return;
        Swal.fire({ title:'Simpan?', text:n, icon:'question', showCancelButton:true }).then(r => { if(r.isConfirmed) processSiswa(); });
    }

    function confirmAddClass() {
        const n = document.getElementById('newClassInp').value; if(!n) return;
        Swal.fire({ title:'Tambah Kelas?', text:n, icon:'info', showCancelButton:true }).then(r => { if(r.isConfirmed) addClass(); });
    }

    function confirmAddSchool() {
        const n = document.getElementById('newSchInp').value; if(!n) return;
        Swal.fire({ title:'Tambah Unit?', text:n, icon:'info', showCancelButton:true }).then(r => { if(r.isConfirmed) addSchool(); });
    }

    async function confirmSaveBranding() {
        Swal.fire({ title:'Update Branding?', icon:'warning', showCancelButton:true }).then(async r => { if(r.isConfirmed) await saveBranding(); });
    }

    // CORE
    function renderMatrix() {
        const sch = master.schools[master.activeSch];
        if(!sch.activeCls || !sch.classes[sch.activeCls]) {
            document.getElementById('matrixTableArea').innerHTML = "<div style='padding:40px; text-align:center; opacity:0.5'>Belum ada kelas. Silakan buat kelas di menu Setting.</div>";
            return;
        }
        const cls = sch.classes[sch.activeCls], month = document.getElementById('selMonth').value;
        const h = document.getElementById('mHead'), b = document.getElementById('mBody');
        let hr = `<tr><th>NO</th><th>NAMA LENGKAP</th>`;
        for(let i=1; i<=31; i++) hr += `<th>${i}</th>`;
        h.innerHTML = hr + `</tr>`;
        b.innerHTML = cls.students.map((s, idx) => {
            let row = `<tr><td>${idx+1}</td><td><b>${s.name}</b></td>`;
            for(let d=1; d<=31; d++){
                const k = `${month}-${String(d).padStart(2,'0')}`;
                const st = (cls.attendance[k] && cls.attendance[k][s.id]) || "";
                row += `<td><div class="day-box ${st.toLowerCase()}-style" onclick="tapAbsen('${k}', ${s.id}, ${d})">${st}</div></td>`;
            }
            return row + `</tr>`;
        }).join('');
    }

    function tapAbsen(date, sId, d) {
        const sch = master.schools[master.activeSch];
        const cls = sch.classes[sch.activeCls];
        if(!cls.attendance[date]) cls.attendance[date] = {};
        const cur = cls.attendance[date][sId] || "";
        const nxt = cur === "" ? "H" : cur === "H" ? "I" : cur === "I" ? "S" : cur === "S" ? "A" : "";
        cls.attendance[date][sId] = nxt;
        save();
        apexToast(`Absen ${nxt} Tersimpan`);
    }

    async function processSiswa() {
        const sch = master.schools[master.activeSch];
        if(!sch.activeCls) return Swal.fire('Error','Pilih/Buat Kelas Dulu','error');
        const cls = sch.classes[sch.activeCls];
        const name = document.getElementById('inSiswaName').value, file = document.getElementById('inSiswaFoto').files[0], eid = document.getElementById('editSId').value;
        let pic = eid ? cls.students.find(x=>x.id==eid).photo : "";
        if(file) pic = await toB64(file);
        if(eid) { const idx = cls.students.findIndex(x=>x.id==eid); cls.students[idx] = { ...cls.students[idx], name, photo: pic }; } 
        else { cls.students.push({ id: Date.now(), name, photo: pic }); }
        cls.students.sort((a,b)=>a.name.localeCompare(b.name));
        save();
        document.getElementById('inSiswaName').value = ""; document.getElementById('editSId').value = ""; document.getElementById('pS').style.display = 'none';
        apexToast('Data Siswa Diperbarui');
    }

    function updateUI() {
        const sch = master.schools[master.activeSch];
        document.getElementById('hSchName').innerText = sch.name;
        document.getElementById('hGuruName').innerText = sch.guru;
        document.getElementById('hClassName').innerText = sch.activeCls ? "UNIT: " + sch.activeCls : "KELAS KOSONG";
        document.getElementById('hLogo').src = sch.logo || 'https://via.placeholder.com/80?text=LOGO';
        document.getElementById('hGuruPic').src = sch.guruPic || `https://ui-avatars.com/api/?name=${sch.guru}&background=0f172a&color=fff`;
        document.getElementById('schBar').innerHTML = Object.keys(master.schools).map(id => `<button class="t-btn ${id === master.activeSch ? 'active-sch' : ''}" onclick="switchSch('${id}')">${master.schools[id].name}</button>`).join('');
        document.getElementById('selClass').innerHTML = Object.keys(sch.classes).length ? Object.keys(sch.classes).map(c => `<option value="${c}" ${c === sch.activeCls ? 'selected' : ''}>${c}</option>`).join('') : "<option>Buat Kelas Dulu</option>";
        document.getElementById('adminPanel').className = master.locked ? 'shield' : '';
        renderMatrix(); renderSiswaList(); renderRekap(); renderPhotos();
    }

    function addClass() { 
        const sch = master.schools[master.activeSch], n = document.getElementById('newClassInp').value.trim(); 
        sch.classes[n] = { students: [], attendance: {} }; sch.activeCls = n; 
        save(); document.getElementById('newClassInp').value = ""; apexToast('Kelas Baru Aktif');
    }

    function addSchool() { 
        const n = document.getElementById('newSchInp').value.trim(); 
        const id = "sch_"+Date.now(); 
        master.schools[id] = { name:n, guru:"Guru", logo:"", guruPic:"", activeCls:"", classes:{} }; 
        master.activeSch = id; save(); document.getElementById('newSchInp').value = ""; apexToast('Unit Ditambahkan');
    }

    function renderSiswaList() {
        const sch = master.schools[master.activeSch];
        if(!sch.activeCls) return document.getElementById('studentList').innerHTML = "";
        const cls = sch.classes[sch.activeCls];
        document.getElementById('studentList').innerHTML = cls.students.map(s => `<div style="display:flex; align-items:center; gap:15px; padding:12px; border-bottom:1px solid #eee"><img src="${s.photo || ''}" style="width:45px;height:45px;border-radius:10px;object-fit:cover;background:#eee" onclick="zoom('${s.photo}')"><div style="flex:1; font-weight:700">${s.name}</div><button onclick="editS(${s.id})" style="border:none;background:#f8fafc;padding:10px;border-radius:10px;color:var(--sec)"><i class="fas fa-edit"></i></button></div>`).join('');
    }

    function renderPhotos() {
        const sch = master.schools[master.activeSch];
        if(!sch.activeCls) return document.getElementById('photoGrid').innerHTML = "";
        const cls = sch.classes[sch.activeCls];
        document.getElementById('photoGrid').innerHTML = cls.students.map(s => `<img src="${s.photo || ''}" style="width:100%; aspect-ratio:1; object-fit:cover; border-radius:12px; background:#eee" onclick="zoom('${s.photo}')">`).join('');
    }

    function renderRekap() {
        const sch = master.schools[master.activeSch];
        if(!sch.activeCls) return document.getElementById('rekapResult').innerHTML = "";
        const cls = sch.classes[sch.activeCls], type = document.getElementById('rekapType').value;
        let h = `<table><tr><th style="width:150px; text-align:left">Nama</th><th>H</th><th>I</th><th>S</th><th>A</th></tr>`;
        cls.students.forEach(s => {
            let c = {H:0, I:0, S:0, A:0};
            Object.keys(cls.attendance).forEach(date => {
                const m = parseInt(date.split('-')[1]);
                if((type==='S1' && m>=7) || (type==='S2' && m<=6) || (type==='THN')) { if(cls.attendance[date][s.id]) c[cls.attendance[date][s.id]]++; }
            });
            h += `<tr><td style="text-align:left"><b>${s.name}</b></td><td style="color:#10b981">${c.H}</td><td style="color:#fbbf24">${c.I}</td><td style="color:#3b82f6">${c.S}</td><td style="color:#ef4444">${c.A}</td></tr>`;
        });
        document.getElementById('rekapResult').innerHTML = h + `</table>`;
    }

    function toggleLock() { Swal.fire({title:'Admin Access', input:'password'}).then(r => { if(r.value === "234") { master.locked = !master.locked; save(); apexToast('Panel Terbuka'); } }); }
    function nav(i) { document.querySelectorAll('.content-area').forEach((c, idx) => c.classList.toggle('content-active', idx === i)); document.querySelectorAll('.nav-item').forEach((n, idx) => n.classList.toggle('active', idx === i)); }
    const toB64 = f => new Promise(res => { const r = new FileReader(); r.readAsDataURL(f); r.onload = () => res(r.result); });
    function preView(i, id) { if(i.files && i.files[0]) { const r = new FileReader(); r.onload = e => { const img = document.getElementById(id); img.src = e.target.result; img.style.display = 'block'; }; r.readAsDataURL(i.files[0]); } }
    function zoom(src) { if(!src || src.includes('placeholder')) return; document.getElementById('zoomImg').src = src; document.getElementById('zoomOverlay').style.display = 'flex'; }
    async function saveBranding() { const sch = master.schools[master.activeSch]; const nS = document.getElementById('inSchName').value, nG = document.getElementById('inGuruName').value; if(nS) sch.name = nS; if(nG) sch.guru = nG; const fL = document.getElementById('inLogo').files[0], fG = document.getElementById('inGuruF').files[0]; if(fL) sch.logo = await toB64(fL); if(fG) sch.guruPic = await toB64(fG); save(); apexToast('Branding Disimpan'); }
    function switchSch(id) { master.activeSch = id; save(); }
    function switchClass(c) { master.schools[master.activeSch].activeCls = c; save(); }
    function exportExcel() { const sch = master.schools[master.activeSch]; if(!sch.activeCls) return; const ws = XLSX.utils.json_to_sheet(sch.classes[sch.activeCls].students); const wb = XLSX.utils.book_new(); XLSX.utils.book_append_sheet(wb, ws, "Siswa"); XLSX.writeFile(wb, "Apex_Report.xlsx"); }
    function startApp() { const mSel = document.getElementById('selMonth'); const now = new Date(); for(let i=0; i<12; i++) { const d = new Date(now.getFullYear(), i, 1); mSel.innerHTML += `<option value="${d.toISOString().substring(0,7)}" ${i===now.getMonth()?'selected':''}>${d.toLocaleString('id-ID', {month:'long', year:'numeric'})}</option>`; } setInterval(() => { document.getElementById('liveClock').innerText = new Date().toLocaleTimeString('id-ID'); }, 1000); updateUI(); }
    window.onload = () => { if(sessionStorage.getItem('usu_auth_v25') === 'true') { currentAcc = sessionStorage.getItem('usu_acc_id'); document.getElementById('loginOverlay').style.display = 'none'; initDB(); } };
    function editS(id) { const sch = master.schools[master.activeSch]; const s = sch.classes[sch.activeCls].students.find(x=>x.id==id); document.getElementById('inSiswaName').value = s.name; document.getElementById('editSId').value = s.id; nav(4); }
    function resetSystem() { Swal.fire({title:'WIPE DATA?', icon:'error', showCancelButton:true}).then(r => { if(r.isConfirmed) { indexedDB.deleteDatabase(DB_NAME); sessionStorage.clear(); location.reload(); } }); }
</script>
</body>
</html>
